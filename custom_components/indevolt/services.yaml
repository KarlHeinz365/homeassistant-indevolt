# ==================== Working Mode Services ====================
set_self_consumption_mode:
  name: Set Self-Consumption Mode
  description: Sets device to Mode 1 (Self-consumed prioritized).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:

set_schedule_mode:
  name: Set Schedule Mode
  description: Sets device to Mode 2 (Charge/discharge Schedule).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:

set_realtime_mode:
  name: Set Real-Time Mode
  description: Sets device to Mode 4 (Real-time control). Required before using charge/discharge/stop commands.
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:

# ==================== Basic Battery Control ====================
charge:
  name: Charge Battery
  description: Charge battery with optional SOC limit. Respects virtual Min-SOC setting. Device must be in Real-time Mode (Mode 4).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:
    power:
      name: Power
      description: Charging power in Watts (Gen1:0-1200W, Gen2:50-2400W).
      required: true
      selector:
        number:
          min: 0
          max: 2400
          unit_of_measurement: W
    soc_limit:
      name: SOC Limit
      description: Stop charging when this SOC percentage is reached (default 100%).
      required: false
      default: 100
      selector:
        number:
          min: 0
          max: 100
          unit_of_measurement: "%"

discharge:
  name: Discharge Battery
  description: Discharge battery with optional SOC limit. Respects virtual Min-SOC setting. Device must be in Real-time Mode (Mode 4).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:
    power:
      name: Power
      description: Discharging power in Watts (Gen1:0-800W, Gen2:50-2400W).
      required: true
      selector:
        number:
          min: 0
          max: 2400
          unit_of_measurement: W
    soc_limit:
      name: SOC Limit
      description: Stop discharging when this SOC percentage is reached (default 5%).
      required: false
      default: 5
      selector:
        number:
          min: 0
          max: 100
          unit_of_measurement: "%"

stop:
  name: Stop Battery
  description: Put battery in standby mode (stops charging and discharging).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:

# ==================== Cluster Mode Services ====================
cluster_charge:
  name: Cluster Charge
  description: Charge battery in cluster mode (command sent only to main device). Respects virtual Min-SOC setting.
  fields:
    power:
      name: Power
      description: Charging power in Watts.
      required: true
      selector:
        number:
          min: 0
          max: 2400
          unit_of_measurement: W
    soc_limit:
      name: SOC Limit
      description: Stop charging when this SOC percentage is reached (default 100%).
      required: false
      default: 100
      selector:
        number:
          min: 0
          max: 100
          unit_of_measurement: "%"

cluster_discharge:
  name: Cluster Discharge
  description: Discharge battery in cluster mode (command sent only to main device). Respects virtual Min-SOC setting.
  fields:
    power:
      name: Power
      description: Discharging power in Watts.
      required: true
      selector:
        number:
          min: 0
          max: 2400
          unit_of_measurement: W
    soc_limit:
      name: SOC Limit
      description: Stop discharging when this SOC percentage is reached (default 5%).
      required: false
      default: 5
      selector:
        number:
          min: 0
          max: 100
          unit_of_measurement: "%"

cluster_stop:
  name: Cluster Stop
  description: Stop battery in cluster mode (command sent only to main device).

# ==================== Gen 2 Advanced Control Services ====================
set_max_ac_output_power:
  name: Set Max AC Output Power
  description: Set maximum AC output power limit (Gen 2 SolidFlex/PowerFlex2000 only).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:
    power:
      name: Power
      description: Maximum AC output power in Watts.
      required: true
      selector:
        number:
          min: 0
          max: 2400
          unit_of_measurement: W

set_feed_in_limit:
  name: Set Feed-in Power Limit
  description: Set grid feed-in power limit (Gen 2 SolidFlex/PowerFlex2000 only).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:
    power:
      name: Power
      description: Feed-in power limit in Watts (0 = no feed-in).
      required: true
      selector:
        number:
          min: 0
          max: 2400
          unit_of_measurement: W

set_grid_charging:
  name: Set Grid Charging
  description: Enable or disable charging from grid (Gen 2 SolidFlex/PowerFlex2000 only).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:
    enable:
      name: Enable
      description: Enable (true) or disable (false) grid charging.
      required: true
      selector:
        boolean:

set_inverter_input_limit:
  name: Set Inverter Input Limit
  description: Set inverter input power limit (Gen 2 SolidFlex/PowerFlex2000 only).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:
    power:
      name: Power
      description: Inverter input limit in Watts.
      required: true
      selector:
        number:
          min: 0
          max: 2400
          unit_of_measurement: W

set_bypass:
  name: Set Bypass
  description: Enable or disable bypass mode (Gen 2 SolidFlex/PowerFlex2000 only).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:
    enable:
      name: Enable
      description: Enable (true) or disable (false) bypass.
      required: true
      selector:
        boolean:

set_backup_soc:
  name: Set Backup SOC
  description: Set backup/emergency power supply SOC threshold (Gen 2 SolidFlex/PowerFlex2000 only).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:
    soc:
      name: SOC
      description: Backup SOC percentage (battery reserves this SOC for emergency).
      required: true
      selector:
        number:
          min: 0
          max: 100
          unit_of_measurement: "%"

set_light:
  name: Set Light
  description: Enable or disable device light/LED (Gen 2 SolidFlex/PowerFlex2000 only).
  fields:
    device_id:
      name: Device ID
      description: Optional device entry_id. If not specified, uses main device or first device.
      required: false
      selector:
        text:
    enable:
      name: Enable
      description: Enable (true) or disable (false) light.
      required: true
      selector:
        boolean:
